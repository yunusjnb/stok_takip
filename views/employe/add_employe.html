<!DOCTYPE html>
<html class="light" lang="tr">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Yeni Çalışan Ekleme</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700;800;900&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#6A994E",
              "background-light": "#F5F5F4",
              "background-dark": "#162210",
            },
            fontFamily: {
              display: ["Work Sans", "Noto Sans", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.25rem",
              lg: "0.5rem",
              xl: "0.75rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
      }
      select.form-input {
        -webkit-appearance: none;
        -moz-appearance: none;
        appearance: none;
        background-image: url(https://lh3.googleusercontent.com/aida-public/AB6AXuB2WRypZ4wGbKR5jmndS1fYApKexCOQ-WqeCh-4STv6KsXrgW0A0sqrx21hlHILendAjZ_WcCN2gegBxSeiJGgStk9YluZk64htfCC3XpRTiU-Pqg6ePS5GZOOb2fEjmjX9ztRRiX-vyuiRdqhkPOOho3s349hcLInI6FyD1a4hMKLPTf6zcmw6b3AL8_PwL_cjShfoaEv839FZZGo5NKClFBBEaSYWvRj0mUihz12HLqeZ_FH2RyVEIsOOZstjiVNeqpFI90NxsjFC);
        background-repeat: no-repeat;
        background-position: right 1rem center;
      }
    </style>
  </head>
  <body
    class="bg-background-light dark:bg-background-dark font-display text-[#162210] dark:text-[#f6f8f6]"
  >
    <div
      class="relative flex h-auto min-h-screen w-full flex-col group/design-root overflow-x-hidden"
    >
      <div class="flex h-full grow flex-row">
        <div id="sidebar-container"></div>
        <div class="mt-auto flex flex-col gap-1" style="position: absolute; bottom: 16px; left: 16px; width: 256px;">
          <a
            class="flex items-center gap-3 px-3 py-2 text-[#121b0d] dark:text-[#f6f8f6] hover:bg-primary/20 rounded-lg"
            href="#"
          >
            <span class="material-symbols-outlined text-xl"
              >help_outline</span
            >
            <p class="text-sm font-medium leading-normal">Yardım</p>
          </a>
          <a
            class="flex items-center gap-3 px-3 py-2 text-[#121b0d] dark:text-[#f6f8f6] hover:bg-primary/20 rounded-lg"
            href="#"
          >
            <span class="material-symbols-outlined text-xl">logout</span>
            <p class="text-sm font-medium leading-normal">Çıkış Yap</p>
          </a>
        </div>
        <main class="flex-1 p-8">
          <div class="w-full max-w-4xl mx-auto flex flex-col gap-8">
            <div class="flex flex-wrap justify-between gap-3">
              <div class="flex flex-col gap-2">
                <p
                  class="text-[#121b0d] dark:text-[#f6f8f6] text-4xl font-black leading-tight tracking-[-0.033em]"
                >
                  Yeni Çalışan Ekleme
                </p>
                <p
                  class="text-[#669a4c] dark:text-[#a3b89b] text-base font-normal leading-normal"
                >
                  Yeni bir çalışan eklemek için aşağıdaki bilgileri doldurun.
                </p>
              </div>
            </div>
            <div
              class="bg-white dark:bg-[#1e2e17] p-8 rounded-xl border border-[#d7e7cf] dark:border-[#2a3c22]"
            >
              <form id="addEmployeeForm" class="flex flex-col gap-6">
                <div class="flex flex-wrap items-end gap-6">
                  <label class="flex flex-col min-w-40 flex-1">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      İsim
                    </p>
                    <input
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#121b0d] dark:text-[#f6f8f6] focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#d7e7cf] dark:border-[#2a3c22] bg-background-light dark:bg-background-dark focus:border-primary/50 h-12 placeholder:text-[#669a4c] dark:placeholder:text-[#a3b89b] px-4 py-2 text-base font-normal leading-normal"
                      placeholder="Çalışanın adını girin"
                      name="name"
                      required
                    />
                  </label>
                  <label class="flex flex-col min-w-40 flex-1">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      Soyisim
                    </p>
                    <input
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#121b0d] dark:text-[#f6f8f6] focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#d7e7cf] dark:border-[#2a3c22] bg-background-light dark:bg-background-dark focus:border-primary/50 h-12 placeholder:text-[#669a4c] dark:placeholder:text-[#a3b89b] px-4 py-2 text-base font-normal leading-normal"
                      placeholder="Çalışanın soyadını girin"
                      name="surname"
                      required
                    />
                  </label>
                </div>
                <div class="flex flex-wrap items-end gap-6">
                  <label class="flex flex-col min-w-40 flex-1">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      Pozisyon
                    </p>
                    <select
                      id="positionSelect"
                      name="position_id"
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#121b0d] dark:text-[#f6f8f6] focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#d7e7cf] dark:border-[#2a3c22] bg-background-light dark:bg-background-dark focus:border-primary/50 h-12 placeholder:text-[#669a4c] dark:placeholder:text-[#a3b89b] px-4 py-2 text-base font-normal leading-normal"
                      required
                    >
                      <option disabled selected value="">
                        Bir pozisyon seçin
                      </option>
                    </select>
                  </label>
                  <!-- <label class="flex flex-col min-w-40 flex-1 opacity-60">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      Çalışma Tipi
                    </p>
                    <div class="flex items-center h-12 px-4 rounded-lg bg-gray-100 dark:bg-gray-800/50 border border-[#d7e7cf] dark:border-[#2a3c22] text-sm text-text-secondary">
                      <span class="material-symbols-outlined text-sm mr-2">auto_awesome</span>
                      Vardiyaya göre otomatik belirlenir
                    </div>
                  </label> -->
                  <label class="flex flex-col min-w-40 flex-1">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      Aylık Maaş
                    </p>
                    <input
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#121b0d] dark:text-[#f6f8f6] focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#d7e7cf] dark:border-[#2a3c22] bg-background-light dark:bg-background-dark focus:border-primary/50 h-12 placeholder:text-[#669a4c] dark:placeholder:text-[#a3b89b] px-4 py-2 text-base font-normal leading-normal"
                      placeholder="Örn: 17500"
                      type="number"
                      name="salary"
                      step="0.01"
                      required
                    />
                  </label>
                </div>
                <div class="flex flex-wrap items-end gap-6">
                  <!-- <label class="flex flex-col min-w-40 flex-1">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      Varsayılan Vardiya
                    </p>
                    <select
                      id="shiftSelect"
                      name="shift_id"
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#121b0d] dark:text-[#f6f8f6] focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#d7e7cf] dark:border-[#2a3c22] bg-background-light dark:bg-background-dark focus:border-primary/50 h-12 placeholder:text-[#669a4c] dark:placeholder:text-[#a3b89b] px-4 py-2 text-base font-normal leading-normal"
                    >
                      <option disabled selected value="">Vardiya seçin</option>
                    </select>
                  </label> -->
                  <label class="flex flex-col min-w-40 flex-1">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      E-posta Adresi
                    </p>
                    <input
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#121b0d] dark:text-[#f6f8f6] focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#d7e7cf] dark:border-[#2a3c22] bg-background-light dark:bg-background-dark focus:border-primary/50 h-12 placeholder:text-[#669a4c] dark:placeholder:text-[#a3b89b] px-4 py-2 text-base font-normal leading-normal"
                      placeholder="ornek@kesiskafe.com"
                      type="email"
                      name="email"
                    />
                  </label>
                  <label class="flex flex-col min-w-40 flex-1">
                    <p
                      class="text-[#121b0d] dark:text-[#f6f8f6] text-sm font-medium leading-normal pb-2"
                    >
                      Telefon Numarası
                    </p>
                    <input
                      class="form-input flex w-full min-w-0 flex-1 resize-none overflow-hidden rounded-lg text-[#121b0d] dark:text-[#f6f8f6] focus:outline-0 focus:ring-2 focus:ring-primary/50 border border-[#d7e7cf] dark:border-[#2a3c22] bg-background-light dark:bg-background-dark focus:border-primary/50 h-12 placeholder:text-[#669a4c] dark:placeholder:text-[#a3b89b] px-4 py-2 text-base font-normal leading-normal"
                      placeholder="555 123 4567"
                      type="tel"
                      name="phone"
                    />
                  </label>
                </div>
                <div
                  class="flex items-center justify-end gap-4 pt-4 mt-4 border-t border-[#d7e7cf] dark:border-[#2a3c22]"
                >
                  <a
                    href="/employe/track"
                    class="px-6 py-2.5 rounded-lg text-sm font-semibold text-[#669a4c] dark:text-[#a3b89b] hover:bg-primary/10"
                  >
                    İptal
                  </a>
                  <button
                    class="px-6 py-2.5 rounded-lg text-sm font-semibold bg-primary text-[#162210] hover:opacity-90"
                    type="submit"
                  >
                    Çalışanı Ekle
                  </button>
                </div>
              </form>
            </div>
          </div>
        </main>
      </div>
    </div>
    <script>
      document.getElementById('addEmployeeForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        const data = {
          name: formData.get('name'),
          surname: formData.get('surname'),
          phone: formData.get('phone'),
          salary: parseFloat(formData.get('salary')),
          salary: parseFloat(formData.get('salary')),
          position_id: formData.get('position_id'),
          shift_id: formData.get('shift_id') || null
        };
        
        try {
          const response = await fetch('/api/employees', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
          });
          
          const result = await response.json();
          
          if (response.ok) {
            alert('Çalışan başarıyla eklendi!');
            window.location.href = '/employe/track';
          } else {
            alert(result.error || 'Bir hata oluştu');
          }
        } catch (error) {
          console.error('Add employee error:', error);
          alert('Bir hata oluştu');
        }
      });

      // Pozisyonları yükle
      async function loadPositions() {
        try {
          const response = await fetch('/api/employees/positions/list');
          const positions = await response.json();
          const select = document.getElementById('positionSelect');
          positions.forEach((pos) => {
            const option = document.createElement('option');
            option.value = pos.id;
            option.textContent = pos.posit_name;
            select.appendChild(option);
          });
        } catch (error) {
          console.error('Pozisyonlar yüklenemedi', error);
        }
      }

      // Yetki kontrolü
      (function guardAdmin() {
        const userType = localStorage.getItem('userType');
        if (!userType) {
          window.location.href = '/';
          return;
        }
        if (userType === 'kasa') {
          window.location.href = '/cashier';
        }
      })();

      // Vardiyaları yükle
      async function loadShifts() {
        try {
          const response = await fetch('/api/employees/shifts/list');
          const shifts = await response.json();
          const select = document.getElementById('shiftSelect');
          shifts.forEach((shift) => {
            const option = document.createElement('option');
            option.value = shift.id;
            option.textContent = `${shift.name} (${shift.start_time.substring(0,5)} - ${shift.end_time.substring(0,5)})`;
            select.appendChild(option);
          });
        } catch (error) {
          console.error('Vardiyalar yüklenemedi', error);
        }
      }

      loadPositions();
      loadShifts();
    </script>
    <script src="/components/sidebar.js"></script>
  </body>
</html>
